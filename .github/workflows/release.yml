name: Validate Project Structure

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  validate:
    name: Validate Project Structure
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Validate project structure
        shell: pwsh
        run: |
          Write-Host 'ğŸ” Validating Aerofly FS4 Bridge project structure...'
          
          # Check main source file
          if (Test-Path 'aerofly_bridge_dll.cpp') {
            Write-Host 'âœ… Main source file found: aerofly_bridge_dll.cpp'
          } else {
            Write-Error 'âŒ Missing main source file: aerofly_bridge_dll.cpp'
          }
          
          # Check documentation
          if (Test-Path 'docs/') {
            $docFiles = Get-ChildItem 'docs/' -Filter '*.md' | Measure-Object
            Write-Host "âœ… Documentation folder found with $($docFiles.Count) markdown files"
          } else {
            Write-Error 'âŒ Missing documentation folder'
          }
          
          # Check build scripts
          if (Test-Path 'scripts/compile.bat') {
            Write-Host 'âœ… Build script found: scripts/compile.bat'
          } else {
            Write-Error 'âŒ Missing build script: scripts/compile.bat'
          }
          
          # Check CHANGELOG
          if (Test-Path 'CHANGELOG.md') {
            Write-Host 'âœ… CHANGELOG.md found'
          } else {
            Write-Error 'âŒ Missing CHANGELOG.md'
          }

      - name: SDK Header Information
        shell: pwsh
        run: |
          Write-Host 'ğŸ“‹ Aerofly SDK Header Information:'
          Write-Host 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'
          
          $headerExists = (Test-Path 'tm_external_message.h') -or (Test-Path 'src/tm_external_message.h')
          if ($headerExists) {
            Write-Host 'âœ… Found tm_external_message.h in repository'
            Write-Host 'ğŸš€ Local compilation can proceed'
          } else {
            Write-Host 'âš ï¸  SDK header not found - this is EXPECTED in CI/CD environment'
            Write-Host ''
            Write-Host 'ğŸ“‹ For local compilation, users must:'
            Write-Host '   1. Download tm_external_message.h from IPACS Developer Site'
            Write-Host '   2. URL: https://www.aerofly.com/developers/ (External DLL section)'
            Write-Host '   3. Place file in project root directory'
            Write-Host '   4. Run: scripts\compile.bat'
            Write-Host ''
            Write-Host 'ğŸ”’ Note: SDK header cannot be distributed due to IPACS licensing'
            Write-Host 'âœ… CI validation completed - source code structure is valid'
            Write-Host ''
            Write-Host 'ğŸ“¦ Releases are created manually by maintainer with compiled DLL'
          }

